<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Supabase Storage PDF Upload + Display</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<style>
	:root {
		--bg: #0b1020;
		--panel: #121933;
		--accent: #6aa9ff;
		--text: #e8ecf3;
		--muted: #aab3c5;
		--danger: #ff6b6b;
		--success: #2ecc71;
	}

	body {
		margin: 0;
		background: radial-gradient(1000px 600px at 15% -100px, #1a2557, transparent 65%), var(--bg);
		color: var(--text);
		font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
		min-height: 100vh;
	}

	.container {
		max-width: 940px;
		margin: 48px auto;
		padding: 0 20px;
	}

	h1 {
		font-size: 1.6rem;
		margin: 0 0 8px;
	}

	p {
		color: var(--muted);
		margin: 0 0 20px;
	}

	.panel {
		background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.03));
		border: 1px solid rgba(255, 255, 255, 0.07);
		border-radius: 16px;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.06);
		padding: 18px;
	}

	.grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 16px;
	}

	@media (min-width: 900px) {
		.grid {
			grid-template-columns: 1fr 1fr;
		}
	}

	.dropzone {
		border: 2px dashed rgba(255, 255, 255, 0.2);
		border-radius: 14px;
		padding: 28px;
		text-align: center;
		transition: border-color .2s, background .2s;
		cursor: pointer;
		background: rgba(255, 255, 255, 0.02);
	}

	.dropzone.dragover {
		border-color: var(--accent);
		background: rgba(106, 169, 255, 0.08);
	}

	.hint {
		color: var(--muted);
		font-size: .95rem;
		margin-top: 6px;
	}

	.controls {
		margin-top: 14px;
		display: flex;
		gap: 10px;
		justify-content: center;
		flex-wrap: wrap;
	}

	.btn {
		appearance: none;
		border: 1px solid rgba(255, 255, 255, 0.15);
		background: rgba(255, 255, 255, 0.06);
		color: var(--text);
		padding: 10px 14px;
		border-radius: 10px;
		cursor: pointer;
		font-weight: 600;
		transition: transform .06s ease, background .2s;
	}

	.btn:hover {
		background: rgba(255, 255, 255, 0.12);
	}

	.btn:active {
		transform: translateY(1px);
	}

	.btn.primary {
		border-color: rgba(106, 169, 255, 0.5);
		background: linear-gradient(180deg, #2a64ff 0%, #1b46c9 100%);
	}

	.status {
		margin-top: 10px;
		min-height: 18px;
		font-size: .95rem;
	}

	.status.ok {
		color: var(--success);
	}

	.status.err {
		color: var(--danger);
	}

	.gallery {
		display: grid;
		grid-template-columns: 1fr;
		gap: 14px;
		margin-top: 8px;
	}

	.card {
		background: rgba(255, 255, 255, 0.03);
		border: 1px solid rgba(255, 255, 255, 0.08);
		border-radius: 12px;
		overflow: hidden;
	}

	.card-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 10px;
		padding: 10px 12px;
		border-bottom: 1px solid rgba(255, 255, 255, 0.08);
		background: rgba(0, 0, 0, 0.15);
	}

	.name {
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
		font-weight: 600;
		font-size: .95rem;
	}

	.links a {
		color: var(--accent);
		text-decoration: none;
		font-weight: 600;
		margin-left: 10px;
	}

	.viewer {
		width: 100%;
		height: 380px;
		border: 0;
		display: block;
		background: #1b2038;
	}

	.empty {
		color: var(--muted);
		padding: 10px;
		font-style: italic;
	}

	.small {
		font-size: .9rem;
		color: var(--muted);
	}
	</style>
</head>

<body>
	<div class="container">
		<h1>PDF Uploader (Supabase Storage)</h1>
		<p>Drop a PDF or choose a file. Uploaded PDFs appear below.</p>
		<div class="grid">
			<div class="panel">
				<div id="dropzone" class="dropzone">
					<div><strong>Drop PDF here</strong> or click to choose</div>
					<div class="hint">Max 20 MB • Only application/pdf</div> <input id="fileInput" type="file" accept="application/pdf" hidden />
				</div>
				<div class="controls"> <button id="chooseBtn" class="btn">Choose PDF</button> <button id="uploadBtn" class="btn primary">Upload</button> </div>
				<div id="status" class="status"></div>
				<div class="small">Bucket: <code>pdfs</code></div>
			</div>
			<div class="panel">
				<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
					<h2 style="margin:0;font-size:1.1rem;">Uploaded PDFs</h2> <button id="refreshBtn" class="btn">Refresh</button>
				</div>
				<div id="gallery" class="gallery"></div>
				<div id="emptyState" class="empty" style="display:none;">No PDFs yet.</div>
			</div>
		</div>
	</div>
	<script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js" crossorigin="anonymous"></script>
	<script>
	const SUPABASE_URL = "https://vehpvfcjceglrftdjlje.supabase.co";
	const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlaHB2ZmNqY2VnbHJmdGRqbGplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTQ5NDEsImV4cCI6MjA3MjU5MDk0MX0.yqZTnMDvCuCqTD9ptkj_Nc-qsvKne-06k8gaRtnYNxc";
	const BUCKET = "pdfs";
	const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
	const dropzone = document.getElementById('dropzone');
	const fileInput = document.getElementById('fileInput');
	const chooseBtn = document.getElementById('chooseBtn');
	const uploadBtn = document.getElementById('uploadBtn');
	const statusEl = document.getElementById('status');
	const galleryEl = document.getElementById('gallery');
	const emptyStateEl = document.getElementById('emptyState');
	const refreshBtn = document.getElementById('refreshBtn');
	let selectedFile = null;

	function setStatus(msg, type) {
		statusEl.className = 'status' + (type ? ' ' + type : '');
		statusEl.textContent = msg || '';
	}

	function sanitizeName(name) {
		const base = name.replace(/\s+/g, '_').replace(/[^\w.\-]/g, '');
		return base.replace(/^\.+/, '');
	}

	function uid() {
		return Date.now().toString(36) + '-' + Math.random().toString(36).slice(2, 8);
	}
	dropzone.addEventListener('click', () => fileInput.click());
	chooseBtn.addEventListener('click', () => fileInput.click());
	dropzone.addEventListener('dragover', (e) => {
		e.preventDefault();
		dropzone.classList.add('dragover');
	});
	dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
	dropzone.addEventListener('drop', (e) => {
		e.preventDefault();
		dropzone.classList.remove('dragover');
		if(!e.dataTransfer.files || !e.dataTransfer.files.length) return;
		const file = e.dataTransfer.files[0];
		handleSelect(file);
	});
	fileInput.addEventListener('change', (e) => {
		const file = e.target.files && e.target.files[0];
		handleSelect(file);
	});

	function handleSelect(file) {
		if(!file) return;
		if(file.type !== 'application/pdf') {
			setStatus('Only PDFs are allowed.', 'err');
			selectedFile = null;
			return;
		}
		const maxBytes = 20 * 1024 * 1024;
		if(file.size > maxBytes) {
			setStatus('File too large. Max 20 MB.', 'err');
			selectedFile = null;
			return;
		}
		selectedFile = file;
		setStatus(`Selected: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`);
	}
	uploadBtn.addEventListener('click', async () => {
		if(!selectedFile) {
			setStatus('Pick a PDF first.', 'err');
			return;
		}
		try {
			await uploadPdf(selectedFile);
			selectedFile = null;
			fileInput.value = '';
			setStatus('Upload complete.', 'ok');
			await loadPdfs();
		} catch (err) {
			setStatus(err.message || 'Upload failed.', 'err');
		}
	});
	refreshBtn.addEventListener('click', loadPdfs);
	async function uploadPdf(file) {
		setStatus('Uploading…');
		const safeName = sanitizeName(file.name);
		const filePath = `${uid()}_${safeName}`;
		const {
			data,
			error
		} = await supabase.storage.from(BUCKET).upload(filePath, file, {
			contentType: file.type || 'application/pdf',
			cacheControl: '3600',
			upsert: false
		});
		if(error) throw error;
		return data;
	}
	async function loadPdfs() {
		galleryEl.innerHTML = '';
		setStatus('Loading…');
		const {
			data,
			error
		} = await supabase.storage.from(BUCKET).list('', {
			limit: 100,
			offset: 0,
			sortBy: {
				column: 'updated_at',
				order: 'desc'
			}
		});
		if(error) {
			setStatus(error.message, 'err');
			emptyStateEl.style.display = 'block';
			return;
		}
		if(!data || data.length === 0) {
			emptyStateEl.style.display = 'block';
			setStatus('');
			return;
		}
		emptyStateEl.style.display = 'none';
		for(const obj of data) {
			const {
				data: pub
			} = supabase.storage.from(BUCKET).getPublicUrl(obj.name);
			const publicUrl = pub.publicUrl;
			const card = document.createElement('div');
			card.className = 'card';
			const header = document.createElement('div');
			header.className = 'card-header';
			const name = document.createElement('div');
			name.className = 'name';
			name.title = obj.name;
			name.textContent = obj.name;
			const links = document.createElement('div');
			links.className = 'links';
			const aOpen = document.createElement('a');
			aOpen.href = publicUrl;
			aOpen.target = '_blank';
			aOpen.rel = 'noopener';
			aOpen.textContent = 'Open';
			const aDownload = document.createElement('a');
			aDownload.href = publicUrl;
			aDownload.download = '';
			aDownload.textContent = 'Download';
			links.appendChild(aOpen);
			links.appendChild(aDownload);
			header.appendChild(name);
			header.appendChild(links);
			const iframe = document.createElement('iframe');
			iframe.className = 'viewer';
			iframe.src = publicUrl + '#view=FitH';
			card.appendChild(header);
			card.appendChild(iframe);
			galleryEl.appendChild(card);
		}
		setStatus('');
	}
	loadPdfs();
	</script>
</body>

</html>
